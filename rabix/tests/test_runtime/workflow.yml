tools:
  add:
    "@type": Script
    inputs:
      type: object
      properties:
        a:
          type: integer
        b:
          type: integer
    outputs:
      type: object
      properties:
        c:
          type: integer
    script: "{ return {c: $job.inputs.a + $job.inputs.b} }"

  mul:
    "@type": Script
    inputs:
      type: object
      properties:
        a:
          type: integer
        b:
          type: integer
    outputs:
      type: object
      properties:
        c:
          type: integer
    script: "{ return {c: $job.inputs.a * $job.inputs.b} }"

  sum:
    "@type": Script
    inputs:
      type: object
      properties:
        items:
          type: array
          items:
            type: integer
    outputs:
      sum:
        type: integer
    script: |
      {
      var result = 0;
      for (var i = 0; i < $job.inputs.length; i++) {
        result += $job.inputs[i];
      }
      return {"sum": result};}


workflows:
  add_one_mul_two:
    "@type": Workflow
    steps:
      - id: add_one
        app:
          $ref: "#/tools/add"
        inputs:
          a:
            $from: a
          b: 1
      - id: times_two
        app:
          $ref: "#/tools/mul"
        inputs:
          a:
            $from: add_one.c
          b: 2
        outputs:
          c:
            $to: result

  add_mul_sum:
    "@type": Workflow
    steps:
      - id: add_mul
        app:
          $ref: "#/workflows/add_one_mul_two"
        inputs:
          a:
            $from: a
      - id: sum
        app:
          $ref: "#/tools/sum"
        inputs:
          items:
            $from: add_mul.result
        outputs:
          sum:
            $to: result

jobs:
  batch_add_one_mul_two:
    "@type": Job
    app:
      $ref: "#workflows/add_one_mul_two"
    inputs:
      a: [1, 2, 3]

  add_mul_sum:
    "@type": Job
    app:
      $ref: "#workflows/add_mul_sum"
    inputs:
      a: [1, 2, 3]

tests:
  batch_add_one_mul_two:
    "@type": Test
    job:
      $ref: "#/jobs/batch_add_one_mul_two"
    outputs:
      result: [4, 6, 8]

  add_mul_sum:
    "@type": Test
    job:
      $ref: "#/jobs/add_mul_sum"
    outputs:
      result: 18
